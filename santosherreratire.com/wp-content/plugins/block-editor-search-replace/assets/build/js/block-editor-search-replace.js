var BESR = BESR || {};var $ = jQuery || {};(function ($, undefined) {  })(jQuery);var BESR = BESR || {};var $ = jQuery || {};(function ($, undefined) {  })(jQuery);(function(wp) {var el                         = wp.element.createElement;var Fragment                   = wp.element.Fragment;var PluginDocumentSettingPanel = wp.editPost.PluginDocumentSettingPanel;var registerPlugin             = wp.plugins.registerPlugin;var dataSelect                 = wp.data.select("core/editor");registerPlugin('block-editor-search-replace-controls', {icon: '',render: function() {return el(Fragment,{},el(PluginDocumentSettingPanel, {name: 'block-editor-search-replace-sidebar',title: 'Search & Replace',className: 'besr-block-editor-ui'},el('div', {dangerouslySetInnerHTML: {__html: `<div class="besr"><div class="besr-block-editor-ui"><p>Block Editor search and replace will help you to find any text inside the Block Editor content area and replace with another one.</p><form name="besr-block-editor" id="besr-block-editor" type="post"><input type="hidden" name="besr-current-post-type" id="besr-current-post-type" value="` + dataSelect.getCurrentPostType() + `"><input type="hidden" name="besr-current-post-id" id="besr-current-post-id" value="` + dataSelect.getCurrentPostId() + `"><input type="hidden" name="besr-classic-editor" id="besr-classic-editor" value="0"><div class="search-replace-group"><p><input type="text" name="besr-search" id="besr-search" class="components-text-control__input besr-search" value="" placeholder="Enter you search phrase..." /></p><p><input type="text" name="besr-replace-with" id="besr-replace-with" class="components-text-control__input besr-replace-with" value="" placeholder="Enter your replace with phrase..." /></p><p><label for="besr-highlight-search"><input type="checkbox" name="besr-highlight-search" id="besr-highlight-search" checked /> <span>Highlight text on search</span></label></p><p><label for="besr-case-sensitive"><input type="checkbox" name="besr-case-sensitive" id="besr-case-sensitive" checked /> <span>Case sensitive search & replace</span></label></p><p class="button-group"><button name="besr-search-replace" class="components-button is-primary besr-search-replace"><i class="dashicons dashicons-randomize"></i>Replace</button><button name="besr-clean-tags" class="components-button is-primary besr-clean-tags"><i class="dashicons dashicons-trash"></i>Reset</button></p><div class="besr-search-replace-output d-none"></div></div></form></div></div>`}}),),);},});})(window.wp);var BESR = BESR || {};var $ = jQuery || {};BESR.highlightSearchText = function(event){event.preventDefault();event.stopPropagation();var $elem = $(event.target);var $form = $(event.target).closest('form');$('.besr-search-replace-output').addClass('d-none').removeClass('d-block');$.ajax({method: 'post',url: besr.ajax_url,data: {action: 'highlight_search',search_input_text: $form.find('input[name="besr-search"]').val(),current_post_id: $form.find('input[name="besr-current-post-id"]').val(),is_highlighted: $form.find('input[name="besr-highlight-search"]:checked').length,is_case_sensitive: $form.find('input[name="besr-case-sensitive"]:checked').length,is_classic_editor: $form.find('input[name="besr-classic-editor"]').val(),},beforeSend: function () { },success: function (data, status, jqxhr) {var results = JSON.parse(data);if (results[0].message !== '') {BESR.reloadBlockEditor($form, $form.find('input[name="besr-classic-editor"]').val());$('.besr-search-replace-output').removeClass('d-none').addClass('d-block');$('.besr-search-replace-output').empty().html(results[0].message);}}});};BESR.runSearchReplace = function(event){event.preventDefault();var $elem = $(event.target);var $form = $(event.target).closest('form');$.ajax({method: 'post',url: besr.ajax_url,data: {action: 'search_and_replace',search_input_text: $form.find('input[name="besr-search"]').val(),replace_input_text: $form.find('input[name="besr-replace-with"]').val(),current_post_id: $form.find('input[name="besr-current-post-id"]').val(),is_case_sensitive: $form.find('input[name="besr-case-sensitive"]:checked').length,is_classic_editor: $form.find('input[name="besr-classic-editor"]').val(),},beforeSend: function () { },success: function (data, status, jqxhr) {var results = JSON.parse(data);if (results[0].message !== '') {BESR.reloadBlockEditor($form, $form.find('input[name="besr-classic-editor"]').val());$('.besr-search-replace-output').removeClass('d-none').addClass('d-block');$('.besr-search-replace-output').empty().html(results[0].message);}}});};BESR.removeAllHighlights = function(event){event.preventDefault();var $elem = $(event.target);var $form = $(event.target).closest('form');$.ajax({method: 'post',url: besr.ajax_url,data: {action: 'clean_besr_tags',current_post_id: $form.find('input[name="besr-current-post-id"]').val(),is_classic_editor: $form.find('input[name="besr-classic-editor"]').val(),},beforeSend: function () { },success: function (data, status, jqxhr) {var results = JSON.parse(data);if (results[0].message !== '') {BESR.reloadBlockEditor($form, $form.find('input[name="besr-classic-editor"]').val());$('.besr-search-replace-output').removeClass('d-none').addClass('d-block');$('.besr-search-replace-output').empty().html(results[0].message);}}});};BESR.reloadBlockEditor = function($form, is_classic_editor) {(function(wp) {$.ajax({method: 'post',url: besr.ajax_url,data: {action: 'update_block_editor_content',current_post_id: $form.find('input[name="besr-current-post-id"]').val(),},beforeSend: function () { },success: function (data, status, jqxhr) {var post_content = JSON.parse(data);if (is_classic_editor == '1') {$('#content_ifr').contents().find('head').append($('<style/>').html('besr-highlight { background-color: #ff8; padding: 3px;}'));$('#content_ifr').contents().find('body').empty().html(post_content);} else {wp.data.dispatch('core/block-editor').resetBlocks(wp.blocks.parse(post_content));}}});})(window.wp);};(function ($, undefined) {  $(document).on('blur', 'input[name="besr-search"]', BESR.highlightSearchText);$(document).on('click', 'button[name="besr-search-replace"]', BESR.runSearchReplace);$(document).on('click', 'button[name="besr-clean-tags"]', BESR.removeAllHighlights);})(jQuery);